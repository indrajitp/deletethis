pipeline{
    agent any
    tools
    {
        maven 'Jenkins-Maven'
        jdk 'Jenkins-Java'
    }
    stages{
        stage ('Initialize'){
            steps {
                sh '''
                    echo "PATH = ${PATH}"
                    echo "M2_HOME = ${M2_HOME}"
                '''
            }
        }
        stage('CheckOut & FindOut'){
            steps{
                script{
                    cleanWs()
                    dir("${WORKSPACE}")
                    {
                        checkout([$class: 'GitSCM', branches: [[name: '*/master']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: '6bbcd2a7-09d4-4f45-9f9a-688c9e2ea1d3', url: 'https://github.com/indrajitp/deletethis.git']]])
                        sh '''
   
							ls -ltr
							pwd
                            git log -1 | grep -i commit | awk '{print $2}' > AD_latestcommitidfile
                            if [ `cat AD_latestcommitidfile` == `cat ~/AD_oldcommitidfile` ]
                            then
                                touch $WORKSPACE/AD_changed_files
                            else
                                git diff HEAD^ HEAD --name-only | awk -F'/' '{print $2}' | grep -vE "jenkinsfile|gitignore|zip" | sort -u > $WORKSPACE/AD_changed_files
                                cat $WORKSPACE/AD_changed_files
                                cat $WORKSPACE/AD_changed_files > ~/file_to_be_build
                                cat ~/file_to_be_build
				
								#echo "Above files are changed"
                                git log -1 | grep -i commit | awk '{print $2}' > ~/AD_oldcommitidfile
                            fi
							pwd
                        '''
                    }
                }
            }
        }
        stage('Build & SCAN'){
            steps{
                script{
                    dir("${WORKSPACE}")
                    {
                       
                    }
                }
            }
        }
    }
   
}
